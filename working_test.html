<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Working Test - Player Info</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      color: #58a6ff;
      margin-bottom: 20px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px 5px;
      border-radius: 6px;
      border: none;
    }
    button {
      background-color: #238636;
      color: white;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      background-color: #161b22;
      padding: 15px;
      border-radius: 10px;
      min-width: 300px;
      max-width: 800px;
      text-align: left;
    }
    .success {
      background-color: #0f2419;
      border: 1px solid #238636;
    }
    .error {
      background-color: #2d1117;
      border: 1px solid #f85149;
      color: #ffa198;
    }
  </style>
</head>
<body>

  <h1>Working Test - Player Lookup</h1>

  <div>
    <input id="tagInput" type="text" placeholder="Enter Player Tag (e.g. 2PP)" />
    <button onclick="fetchPlayer()">Fetch</button>
  </div>

  <div class="result" id="playerInfo">
    Enter a player tag and click Fetch
  </div>

  <script>
    // API Authorization Token
    const API_TOKEN = "JkMiniDev%1998";

    async function fetchPlayer() {
      const tag = document.getElementById("tagInput").value.trim();
      const playerInfo = document.getElementById("playerInfo");
      
      if (!tag) {
        playerInfo.innerHTML = "Please enter a player tag";
        playerInfo.className = "result error";
        return;
      }

      // Exactly like your working code
      const url = `https://api.jktripuri.site/players/${tag.replace("#", "%23")}`;
      
      playerInfo.innerHTML = "Loading...";
      playerInfo.className = "result";

      try {
        console.log('Fetching from URL:', url);
        
        const res = await fetch(url, {
          headers: {
            'Authorization': `Bearer ${API_TOKEN}`
          }
        });

        console.log('Response status:', res.status);
        console.log('Response ok:', res.ok);

        if (!res.ok) {
          const errorText = await res.text();
          console.log('Error response:', errorText);
          throw new Error(`Server responded with ${res.status}: ${errorText}`);
        }

        const data = await res.json();
        console.log('Player data received:', data);

        // Success - show player info
        playerInfo.className = "result success";
        playerInfo.innerHTML = `
          <h3>${data.name || 'Unknown Player'}</h3>
          <p><strong>Tag:</strong> ${data.tag || 'N/A'}</p>
          <p><strong>Town Hall Level:</strong> ${data.townHallLevel || 'N/A'}</p>
          <p><strong>Experience Level:</strong> ${data.expLevel || 'N/A'}</p>
          <p><strong>Trophies:</strong> ${data.trophies || 'N/A'}</p>
          <p><strong>Best Trophies:</strong> ${data.bestTrophies || 'N/A'}</p>
          <p><strong>War Stars:</strong> ${data.warStars || 'N/A'}</p>
          <p><strong>Clan:</strong> ${data.clan ? data.clan.name : 'None'}</p>
          <p><strong>Role:</strong> ${data.role || 'N/A'}</p>
          <p><strong>War Preference:</strong> ${data.warPreference || 'N/A'}</p>
        `;

      } catch (err) {
        console.error("Fetch error:", err);
        playerInfo.className = "result error";
        playerInfo.innerHTML = `
          <div>
            <strong>Error fetching player data:</strong><br>
            ${err.message}<br><br>
            <strong>Details:</strong><br>
            Tag entered: ${tag}<br>
            URL called: ${url}<br><br>
            <strong>Make sure:</strong><br>
            1. You entered a valid player tag (e.g. #ABC123 or ABC123)<br>
            2. The player exists<br>
            3. You have proper authorization<br>
          </div>
        `;
      }
    }

    // Test the URL formation immediately
    console.log('=== URL Formation Tests ===');
    const testTags = ['2PP', '#2PP', 'ABC123', '#ABC123'];
    testTags.forEach(tag => {
      const url = `https://api.jktripuri.site/players/${tag.replace("#", "%23")}`;
      console.log(`Tag "${tag}" -> URL: ${url}`);
    });
  </script>
</body>
</html>